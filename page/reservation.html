<!DOCTYPE html>
<html lang="en" data-theme="nord">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<link rel="stylesheet" href="../css/index.css" />
		<link
			href="https://cdn.jsdelivr.net/npm/daisyui@4.12.7/dist/full.min.css"
			rel="stylesheet"
			type="text/css"
		/>
		<link
			rel="stylesheet"
			href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
		/>

		<title>Nilam Public Swimming Pool</title>
	</head>
	<body>
		<!-- Navbar -->
		<div class="sticky top-0 z-50 navbar bg-secondary text-secondary-content">
			<div class="navbar-start">
				<div class="dropdown">
					<div tabindex="0" role="button" class="btn btn-ghost btn-circle">
						<svg
							xmlns="http://www.w3.org/2000/svg"
							class="h-5 w-5"
							fill="none"
							viewBox="0 0 24 24"
							stroke="currentColor"
						>
							<path
								stroke-linecap="round"
								stroke-linejoin="round"
								stroke-width="2"
								d="M4 6h16M4 12h16M4 18h7"
							/>
						</svg>
					</div>
					<ul
						tabindex="0"
						class="menu menu-sm dropdown-content bg-base-100 rounded-box z-[1] mt-3 w-52 p-2 shadow"
					>
						<li>
							<a href="home.html">Home</a>
						</li>
						<li>
							<a href="gallery.html">Gallery</a>
						</li>
						<li>
							<a href="services-&-facilities.html">Services & Facilities</a>
						</li>
						<li>
							<a href="offers.html">Offers</a>
						</li>
						<li>
							<a href="reservation.html" class="active">Reservation</a>
						</li>
						<li>
							<a href="reviews.html">Reviews</a>
						</li>
					</ul>
				</div>
			</div>
			<div class="navbar-center">
				<a class="text-xl font-bold" href="home-page.html">Nilam Pool</a>
			</div>
			<div class="navbar-end">
				<label class="swap swap-rotate">
					<!-- this hidden checkbox controls the state -->
					<input type="checkbox" class="theme-controller" value="dim" />

					<!-- sun icon -->
					<svg
						class="swap-off h-8 w-8 fill-current"
						xmlns="http://www.w3.org/2000/svg"
						viewBox="0 0 24 24"
					>
						<path
							d="M5.64,17l-.71.71a1,1,0,0,0,0,1.41,1,1,0,0,0,1.41,0l.71-.71A1,1,0,0,0,5.64,17ZM5,12a1,1,0,0,0-1-1H3a1,1,0,0,0,0,2H4A1,1,0,0,0,5,12Zm7-7a1,1,0,0,0,1-1V3a1,1,0,0,0-2,0V4A1,1,0,0,0,12,5ZM5.64,7.05a1,1,0,0,0,.7.29,1,1,0,0,0,.71-.29,1,1,0,0,0,0-1.41l-.71-.71A1,1,0,0,0,4.93,6.34Zm12,.29a1,1,0,0,0,.7-.29l.71-.71a1,1,0,1,0-1.41-1.41L17,5.64a1,1,0,0,0,0,1.41A1,1,0,0,0,17.66,7.34ZM21,11H20a1,1,0,0,0,0,2h1a1,1,0,0,0,0-2Zm-9,8a1,1,0,0,0-1,1v1a1,1,0,0,0,2,0V20A1,1,0,0,0,12,19ZM18.36,17A1,1,0,0,0,17,18.36l.71.71a1,1,0,0,0,1.41,0,1,1,0,0,0,0-1.41ZM12,6.5A5.5,5.5,0,1,0,17.5,12,5.51,5.51,0,0,0,12,6.5Zm0,9A3.5,3.5,0,1,1,15.5,12,3.5,3.5,0,0,1,12,15.5Z"
						/>
					</svg>

					<!-- moon icon -->
					<svg
						class="swap-on h-8 w-8 fill-current"
						xmlns="http://www.w3.org/2000/svg"
						viewBox="0 0 24 24"
					>
						<path
							d="M21.64,13a1,1,0,0,0-1.05-.14,8.05,8.05,0,0,1-3.37.73A8.15,8.15,0,0,1,9.08,5.49a8.59,8.59,0,0,1,.25-2A1,1,0,0,0,8,2.36,10.14,10.14,0,1,0,22,14.05,1,1,0,0,0,21.64,13Zm-9.5,6.69A8.14,8.14,0,0,1,7.08,5.22v.27A10.15,10.15,0,0,0,17.22,15.63a9.79,9.79,0,0,0,2.1-.22A8.11,8.11,0,0,1,12.14,19.73Z"
						/>
					</svg>
				</label>
			</div>
		</div>
		<!-- End Navbar -->

		<!-- Reservation Page -->
		<div class="my-12 flex justify-center">
			<div
				class="card bg-neutral text-neutral-content w-1/2 shrink-0 shadow-2xl"
			>
				<h3 class="text-center font-bold text-2xl mt-8">Reservation</h3>
				<form id="reserveForm" class="card-body">
					<!-- Personal Data -->
					<h3 class="text-lg font-medium">Personal Data</h3>
					<div class="form-control">
						<label class="label">
							<span class="label-text text-neutral-content">Email</span>
						</label>
						<input
							id="email"
							type="email"
							placeholder="email@gmail.com"
							class="input input-bordered text-[black] font-medium"
							required
						/>
					</div>
					<div class="form-control">
						<label class="label">
							<span class="label-text text-neutral-content">Name</span>
						</label>
						<input
							id="name"
							type="text"
							placeholder="Dnsy"
							class="input input-bordered text-[black] font-medium"
							required
						/>
					</div>

					<!-- Ticket -->
					<h3 class="text-lg font-medium mt-2">Ticket</h3>
					<div class="form-control">
						<label class="label">
							<span class="label-text text-neutral-content">Adult</span>
						</label>
						<div class="join join-horizontal">
							<button
								type="button"
								class="btn btn-secondary join-item"
								onclick="decrementTicketAdult()"
							>
								-
							</button>
							<input
								id="ticketAdult"
								type="number"
								value="0"
								class="input rounded-none input-bordered text-[black] font-medium text-center font-bold w-full"
								disabled
							/>
							<input
								id="hiddenTicketAdult"
								type="hidden"
								value="0"
								class="input input-bordered text-[black] font-medium text-center font-bold w-full"
								disabled
							/>
							<button
								type="button"
								class="btn btn-secondary join-item"
								onclick="incrementTicketAdult()"
							>
								+
							</button>
						</div>
					</div>
					<div class="form-control">
						<label class="label">
							<span class="label-text text-neutral-content">Kids</span>
						</label>
						<div class="join join-horizontal">
							<button
								type="button"
								class="btn btn-secondary join-item"
								onclick="decrementTicketKid()"
							>
								-
							</button>
							<input
								id="ticketKid"
								type="number"
								value="0"
								class="input rounded-none input-bordered text-[black] font-medium text-center font-bold w-full"
								disabled
							/>
							<input
								id="hiddenTicketKid"
								type="hidden"
								value="0"
								class="input input-bordered text-[black] font-medium text-center font-bold w-full"
								disabled
							/>
							<button
								type="button"
								class="btn btn-secondary join-item"
								onclick="incrementTicketKid()"
							>
								+
							</button>
						</div>
					</div>

					<!-- Additional Offers -->
					<div class="mt-2">
						<h4 class="text-lg font-medium">Additional Offers</h4>

						<div class="form-control">
							<label class="label cursor-pointer">
								<span class="label-text text-neutral-content"
									>Snacks and Lunch</span
								>
								<input
									id="snacksLunch"
									type="checkbox"
									class="checkbox checkbox-secondary"
								/>
							</label>
						</div>
						<div class="form-control">
							<label class="label cursor-pointer">
								<span class="label-text text-neutral-content"
									>Swimming Kit</span
								>
								<input
									id="swimKit"
									type="checkbox"
									class="checkbox checkbox-secondary"
								/>
							</label>
						</div>
					</div>

					<!-- Discount Voucher -->
					<h4 class="text-lg font-medium mt-2">Discount Voucher</h4>
					<div class="form-control">
						<label class="label">
							<span class="label-text text-neutral-content">Voucher</span>
						</label>
						<input
							id="voucher"
							type="text"
							placeholder="D10000"
							class="input input-bordered text-[black] font-medium"
						/>
					</div>

					<!-- Price -->
					<div
						class="card px-5 py-3 bg-accent text-accent-content w-1/4 shadow-2xl fixed bottom-[2rem] right-[1rem]"
					>
						<h3 class="text-xl font-semibold mb-2 text-center">Receipt</h3>
						<h4 class="font-medium text-lg">Ticket</h4>
						<p id="priceTicketAdult" class="text-base">
							Adult: 0 x Rp30,000 = Rp0,000
						</p>
						<p id="priceTicketKid" class="text-base">
							Kid: 0 x Rp25,000 = Rp0,000
						</p>
						<h4 class="font-medium text-lg">Additional</h4>
						<p id="priceSnacks" class="text-base">Snacks & Lunch: No</p>
						<p id="priceSwimKit" class="text-base">Swimming Kit: No</p>
						<h4 class="font-medium text-lg">Voucher</h4>
						<p id="voucherInfo" class="text-base">Code: Invalid</p>
						<p id="voucherDiscount" class="text-base">Discount: - Rp0,000</p>
						<h4 id="totalPrice" class="font-medium text-lg mt-8">
							Total Price: Rp0,000
						</h4>
					</div>

					<div class="form-control mt-6">
						<button id="reserveBtn" type="submit" class="btn btn-primary">
							Reserve
						</button>
					</div>
				</form>
			</div>
		</div>

		<!-- Confirm Modal -->
		<dialog id="confirmModal" class="modal">
			<div
				class="modal-box flex flex-col items-center bg-secondary text-secondary-content"
			>
				<h3 class="text-lg font-bold">Thanks for Reserved!</h3>
				<p class="py-4">Please save QR Code and scan QR at Gate later!</p>

				<img id="qrcode" alt="QR Code will appear here" class="w-30 h-30" />
				<a
					class="mt-4 btn btn-success rounded-lg mb-5 font-semibold text-lg"
					id="downloadQRBtn"
					download="qrcode.png"
					>Download QR Code</a
				>

				<button class="btn btn-info rounded-lg" id="scanQRBtn">
					Scan QR Code
				</button>
				<input
					type="file"
					id="fileInput"
					accept="image/*"
					class="file-input hidden file-input-bordered file-input-accent w-full max-w-xs"
				/>

				<pre id="decodedText"></pre>

				<div class="modal-action">
					<form method="dialog">
						<!-- if there is a button in form, it will close the modal -->
						<button class="btn btn-accent rounded-lg">Close</button>
					</form>
				</div>
			</div>
		</dialog>
		<!-- End Reservation Page -->

		<!-- Footer -->
		<footer
			class="footer bg-secondary text-secondary-content p-10 items-center"
		>
			<nav>
				<h6 class="footer-title">Location</h6>
				<iframe
					class="rounded"
					width="500"
					height="300"
					frameborder="0"
					scrolling="no"
					marginheight="0"
					marginwidth="0"
					src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d1982.9259081418036!2d106.87306403840144!3d-6.283202432326569!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e69f28e678fbc9f%3A0xbedbf07d7e3182e7!2sKolam%20Renang%20Nilam%20Kramat%20Jati!5e0!3m2!1sen!2sus!4v1719221456059!5m2!1sen!2sus"
					allowfullscreen=""
					loading="lazy"
					referrerpolicy="no-referrer-when-downgrade"
				></iframe>
			</nav>
			<aside class="grid-flow-row justify-items-center items-center gap-5">
				<svg
					class="fa-flip-horizontal w-[50px] h-[50px]"
					xmlns="http://www.w3.org/2000/svg"
					viewBox="0 0 576 512"
				>
					<path
						d="M309.5 178.4L447.9 297.1c-1.6 .9-3.2 2-4.8 3c-18 12.4-40.1 20.3-59.2 20.3c-19.6 0-40.8-7.7-59.2-20.3c-22.1-15.5-51.6-15.5-73.7 0c-17.1 11.8-38 20.3-59.2 20.3c-10.1 0-21.1-2.2-31.9-6.2C163.1 193.2 262.2 96 384 96h64c17.7 0 32 14.3 32 32s-14.3 32-32 32H384c-26.9 0-52.3 6.6-74.5 18.4zM160 160A64 64 0 1 1 32 160a64 64 0 1 1 128 0zM306.5 325.9C329 341.4 356.5 352 384 352c26.9 0 55.4-10.8 77.4-26.1l0 0c11.9-8.5 28.1-7.8 39.2 1.7c14.4 11.9 32.5 21 50.6 25.2c17.2 4 27.9 21.2 23.9 38.4s-21.2 27.9-38.4 23.9c-24.5-5.7-44.9-16.5-58.2-25C449.5 405.7 417 416 384 416c-31.9 0-60.6-9.9-80.4-18.9c-5.8-2.7-11.1-5.3-15.6-7.7c-4.5 2.4-9.7 5.1-15.6 7.7c-19.8 9-48.5 18.9-80.4 18.9c-33 0-65.5-10.3-94.5-25.8c-13.4 8.4-33.7 19.3-58.2 25c-17.2 4-34.4-6.7-38.4-23.9s6.7-34.4 23.9-38.4c18.1-4.2 36.2-13.3 50.6-25.2c11.1-9.4 27.3-10.1 39.2-1.7l0 0C136.7 341.2 165.1 352 192 352c27.5 0 55-10.6 77.5-26.1c11.1-7.9 25.9-7.9 37 0z"
					/>
				</svg>

				<div class="text-center">
					<p class="text-xl font-bold mb-2">Nilam Public Swimming Pool</p>
					<p class="text-base font-bold mt-0">
						Providing swimming pool since 2016
					</p>
				</div>

				<div class="grid grid-flow-col gap-4">
					<a>
						<svg
							xmlns="http://www.w3.org/2000/svg"
							width="36"
							height="36"
							viewBox="0 0 36 36"
							class="fill-current"
						>
							<path
								d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z"
							></path>
						</svg>
					</a>
					<a>
						<svg
							xmlns="http://www.w3.org/2000/svg"
							width="36"
							height="36"
							viewBox="0 0 36 36"
							class="fill-current"
						>
							<path
								d="M19.615 3.184c-3.604-.246-11.631-.245-15.23 0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23 0 3.897-.266 4.356-2.62 4.385-8.816-.029-6.185-.484-8.549-4.385-8.816zm-10.615 12.816v-8l8 3.993-8 4.007z"
							></path>
						</svg>
					</a>
					<a>
						<svg
							xmlns="http://www.w3.org/2000/svg"
							width="36"
							height="36"
							viewBox="0 0 36 36"
							class="fill-current"
						>
							<path
								d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z"
							></path>
						</svg>
					</a>
				</div>

				<div>
					<p class="text-sm">
						Copyright Â© 2024 - All right reserved by Nilam Swimming Pool
					</p>
				</div>
			</aside>
		</footer>
		<!-- End Footer -->

		<script src="../js/index.js"></script>
		<script src="../js/reservation.js"></script>
		<script type="module">
			import { myModule } from "../js/tailwind.config.js";
			myModule();
		</script>
		<script src="https://cdn.tailwindcss.com"></script>

		<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/html5-qrcode/2.3.8/html5-qrcode.min.js"></script>
		<script>
			let currentQRCodeURL = "";
			let price = {
				adult: 0,
				kid: 0,
				snacks: 0,
				swimKit: 0,
				discount: 0,
				totalTicket: 0,
				totalPrice: 0,
			};

			document
				.getElementById("reserveForm")
				.addEventListener("submit", function (e) {
					e.preventDefault();
					const data = {
						email: document.getElementById("email").value,
						name: document.getElementById("name").value,
						ticketAdult: document.getElementById("ticketAdult").value,
						ticketKid: document.getElementById("ticketKid").value,
						snacks: document.getElementById("snacksLunch").checked,
						swimKit: document.getElementById("swimKit").checked,
						voucher: document.getElementById("voucher").value
							? document.getElementById("voucher").value
							: "Invalid",
						discount: checkDiscountForReceipt(),
					};

					const qrText = `Personal Data\nEmail: ${data.email}\nName: ${
						data.name
					}\n\nTicket\nAdult: ${countTotalPriceForReceipt(
						"adult"
					)}\nKid: ${countTotalPriceForReceipt(
						"kid"
					)}\n\nAdditional\nSnacks & Lunch: ${
						data.snacks ? countTotalPriceForReceipt("snacks") : "No"
					}\nSwimming Kit: ${
						data.swimKit ? countTotalPriceForReceipt("swimKit") : "No"
					}\n\nVoucher\nCode: ${data.voucher}\nDiscount: ${
						data.discount
					}\n\nTotal Price: ${countTotalPriceForReceipt("totalPrice")}`;

					currentQRCodeURL = `https://api.qrserver.com/v1/create-qr-code/?data=${encodeURIComponent(
						qrText
					)}&size=200x200`;

					document.getElementById("qrcode").src = currentQRCodeURL;

					document.getElementById("confirmModal").showModal();
				});

			document
				.getElementById("downloadQRBtn")
				.addEventListener("click", function () {
					if (currentQRCodeURL) {
						fetch(currentQRCodeURL)
							.then((response) => response.blob())
							.then((blob) => {
								const url = window.URL.createObjectURL(blob);
								const a = document.createElement("a");
								a.style.display = "none";
								a.href = url;
								a.download = "qrcode.png";
								document.body.appendChild(a);
								a.click();
								window.URL.revokeObjectURL(url);
								document.body.removeChild(a);
							})
							.catch(() => alert("Failed to download QR code."));
					} else {
						alert("Please generate a QR code first.");
					}
				});

			document
				.getElementById("scanQRBtn")
				.addEventListener("click", function () {
					document.getElementById("fileInput").click();
				});

			document
				.getElementById("fileInput")
				.addEventListener("change", (event) => {
					const file = event.target.files[0];
					if (file) {
						const formData = new FormData();
						formData.append("file", file);

						fetch("https://api.qrserver.com/v1/read-qr-code/", {
							method: "POST",
							body: formData,
						})
							.then((response) => response.json())
							.then((result) => {
								const decodedTextValue = result[0]?.symbol[0]?.data;
								if (decodedTextValue) {
									document.getElementById("decodedText").textContent =
										decodedTextValue;
								} else {
									document.getElementById("decodedText").textContent =
										"No QR code found or unable to decode.";
								}
							})
							.catch((err) => {
								console.error("Error decoding QR code:", err);
							});
					}
				});

			let checkDiscountForReceipt = () => {
				switch (document.getElementById("voucher").value) {
					case "D10000":
						price.discount = 10;
						return "- Rp10,000";
						break;
					case "D20000":
						price.discount = 20;
						return "- Rp20,000";
						break;
					case "DS50000":
						price.discount = 50;
						return "- Rp50,000";
						break;
					case "DX100000":
						price.discount = 100;
						return "- Rp100,000";
						break;
					case "DM375000":
						price.discount = 275;
						return "- Rp375,000";
						break;
					default:
						price.discount = 0;
						return "- Rp0,000";
						break;
				}
			};

			let countTotalPriceForReceipt = (typePrice) => {
				let adult = parseInt(document.getElementById("ticketAdult").value);
				let kid = parseInt(document.getElementById("ticketKid").value);
				let snacks = document.getElementById("snacksLunch");
				let swimKit = document.getElementById("swimKit");
				let totalTicket = adult + kid;
				let result;

				switch (typePrice) {
					case "adult":
						result = adult * 30;
						return `${adult} x Rp30,000 = Rp${result},000`;
						break;
					case "kid":
						result = kid * 25;
						return `${kid} x Rp25,000 = Rp${result},000`;
						break;
					case "snacks":
						result = totalTicket * 20;
						return `${totalTicket} x Rp20,000 = Rp${result},000`;
						break;
					case "swimKit":
						result = totalTicket * 15;
						return `${totalTicket} x Rp15,000 = Rp${result},000`;
						break;
					case "totalPrice":
						result =
							adult * 30 +
							kid * 25 +
							(snacks.checked ? totalTicket * 20 : 0) +
							(swimKit.checked ? totalTicket * 15 : 0) -
							price.discount;
						return `Rp${result},000`;
						break;
					default:
						console.log("countTotalPriceForReceipt", "error pass data");
						break;
				}
			};
		</script>
	</body>
</html>
